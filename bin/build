#!/bin/bash
set -euo pipefail
cd "$(cd "$(dirname "$0")"; cd ..; pwd)"

NAME=auth-gke

if [[ -z "${OWNER-}" ]]; then
  OWNER=tonglil
fi

TAG="latest"
DOCKERFILE="Dockerfile"

if ! [[ -z $1 ]]; then
  TAG="$1"
  DOCKERFILE+=".$1"
fi

BRANCH="$(git rev-parse --abbrev-ref HEAD)"
if [[ "$BRANCH" != "master" ]]; then
  TAG="$BRANCH-$TAG"
fi

docker build -t "$OWNER/$NAME:$TAG" -f "$DOCKERFILE" .
